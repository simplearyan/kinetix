---
interface Props {
    direction?:
        | "up"
        | "down"
        | "left"
        | "right"
        | "up-right"
        | "up-left"
        | "down-right"
        | "down-left";
    color?: string;
    width?: number;
    class?: string;
    flip?: boolean;
}

const {
    direction = "right",
    color = "red",
    width = 60,
    class: className,
    flip = false,
} = Astro.props;

const rotationMap: Record<string, string> = {
    right: "0deg",
    "down-right": "45deg",
    down: "90deg",
    "down-left": "135deg",
    left: "180deg",
    "up-left": "225deg",
    up: "270deg",
    "up-right": "315deg",
};

const rotate = rotationMap[direction] || "0deg";
const scaleX = flip ? -1 : 1;
---

<div
    class={`vox-arrow ${className || ""}`}
    style={`--arrow-color: ${color}; width: ${width}px; transform: rotate(${rotate}) scaleX(${scaleX});`}
>
    <svg viewBox="0 0 100 50" preserveAspectRatio="none">
        <path d="M5,25 Q50,5 90,25" fill="none" class="arrow-path"></path>
        <path d="M90,25 L80,15 M90,25 L80,35" fill="none" class="arrow-head"
        ></path>
    </svg>
</div>

<style>
    .vox-arrow {
        display: inline-block;
        aspect-ratio: 2/1;
        pointer-events: none;
    }

    svg {
        width: 100%;
        height: 100%;
        overflow: visible;
    }

    path {
        stroke: var(--arrow-color);
        stroke-width: 3;
        stroke-linecap: round;
        stroke-linejoin: round;
        vector-effect: non-scaling-stroke;
    }

    .vox-arrow.visible .arrow-path {
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
        animation: drawPath 0.6s ease-out forwards;
    }

    .vox-arrow.visible .arrow-head {
        opacity: 0;
        animation: fadeIn 0.1s ease-out 0.6s forwards;
    }

    @keyframes drawPath {
        to {
            stroke-dashoffset: 0;
        }
    }
    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }
</style>

<script>
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    observer.unobserve(entry.target);
                }
            });
        },
        { threshold: 0.5 },
    );

    document
        .querySelectorAll(".vox-arrow")
        .forEach((el) => observer.observe(el));
</script>
