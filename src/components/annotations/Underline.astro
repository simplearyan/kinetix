---
interface Props {
    color?: string;
    class?: string;
}

const { color = "red", class: className } = Astro.props;
---

<span
    class={`vox-underline ${className || ""}`}
    style={`--underline-color: ${color};`}
>
    <slot />
    <svg class="squiggly-svg" viewBox="0 0 100 20" preserveAspectRatio="none">
        <path d="M0,10 Q10,20 20,10 T40,10 T60,10 T80,10 T100,10" pathLength="1"
        ></path>
    </svg>
</span>

<style>
    .vox-underline {
        position: relative;
        display: inline-block;
    }
    .squiggly-svg {
        position: absolute;
        bottom: -0.2em;
        left: 0;
        width: 100%;
        height: 0.5em;
        pointer-events: none;
        overflow: visible;
    }
    path {
        fill: none;
        stroke: var(--underline-color);
        stroke-width: 3px;
        stroke-linecap: round;
        stroke-linejoin: round;
        vector-effect: non-scaling-stroke;
        stroke-dasharray: 1;
        stroke-dashoffset: 1;
    }

    .vox-underline.visible path {
        animation: drawSquiggle 0.6s linear forwards;
    }

    @keyframes drawSquiggle {
        to {
            stroke-dashoffset: 0;
        }
    }
</style>

<script>
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    observer.unobserve(entry.target);
                }
            });
        },
        { threshold: 0.5 },
    );
    document
        .querySelectorAll(".vox-underline")
        .forEach((el) => observer.observe(el));
</script>
